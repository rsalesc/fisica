---
title: "Física - Discussão Projeto I"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = "*")
knitr::opts_chunk$set(fig.width=3)
knitr::opts_chunk$set(fig.height=2)
knitr::opts_chunk$set(fig.align="center")

library(gridExtra)
library(grid)
library(latex2exp)
library(ggplot2)
```

```{r include=FALSE}
# Setup tableGrob theme with text parsing
tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)))

math = function(s) { paste0("$", s, "$") }
parens = function(s) { paste0("(", s, ")") }
subscript = function(s, v) { math(paste0(s, "_{", v, "}")) }
flatten_by_rows = function(m) { c(t(m)) }

ph.TeX.energia = math("J")
ph.TeX.deslocamento = math("m")
ph.TeX.velocidade = math("m/s")
ph.TeX.tempo = math("s")
ph.TeX.aceleracao = math("m/s^2")
ph.TeX.massa = math("kg")
ph.TeX.forca = math("N")
ph.TeX.potencia = math("W")
```


### Parâmetros dos experimentos

```{r}
p.massa = 0.2107

# Posição inicial do fim da bandeira
p.bandeira = 0.204

# Tamanho da bandeira
p.tam_bandeira = 0.0975

# Distância entre sensores adjacentes
p.MRU.distancias = c(0.373, 0.322, 0.655, 0.37)
p.MRU.posicoes = cumsum(p.MRU.distancias) - p.bandeira


p.MUV.distancias = c(0.207 + p.bandeira, 0.414, 0.427, 0.49)
p.MUV.posicoes = cumsum(p.MUV.distancias) - p.bandeira

p.MUV_flag.distancias = c(0.406, 0.49, 0.354, 0.495)
p.MUV_flag.posicoes = cumsum(p.MUV.distancias) - p.bandeira
```


### Dados dos experimentos

Os dados dos experimentos MU e MUV já foram carregados a partir de arquivos `.csv`.

```{r}
dados.MRU = read.csv("mru.csv")
dados.MUV = read.csv("muv.csv")
dados.MUV_flag = read.csv("muv_flag.csv")
```

```{r, fig.height=2, echo=FALSE}
colnames(dados.MRU) = TeX(paste(subscript("t", 1:4), parens(ph.TeX.tempo)))
grid.arrange(top="Observações - MRU", tableGrob(dados.MRU, theme=tt))
```
```{r, fig.height=1, echo=FALSE}
colnames(dados.MUV) = TeX(paste(subscript("t", 1:4), parens(ph.TeX.tempo)))
grid.arrange(top="Observações - MUV", tableGrob(dados.MUV, theme=tt))
```
```{r, fig.height=2, echo=FALSE}
colnames(dados.MUV_flag) = TeX(paste(subscript("t", 1:4), parens(ph.TeX.tempo)))
grid.arrange(top="Observações - MUV (bandeira)", tableGrob(dados.MUV_flag, theme=tt))
```

### Funções e constantes
```{r}
# Constantes comuns (physics)
ph.G = 9.807

# Funções comuns (physics)
ph.peso = function(m, g = ph.G) { m*g }
ph.e.potencial = function(m, h, g = ph.G) { m*g*h }
ph.e.cinetica = function(v, m) { 0.5*m*v^2 }
ph.trabalho = function(f, dx, theta) { f*dx*theta }

# Funções MRU
MRU.velocidade = function(ds, dt) { ds/dt }
MRU.deslocamento = function(v, t) { v*t }

# Funções MUV
MUV.velocidade = function(a, t, v0 = 0) { v0 + a*t }
MUV.deslocamento = function(a, t, v0 = 0) { t*v0 + 0.5*a*t^2 }
```

### Tabelas

#### MRU

```{r, fig.width=5, fig.height=3.5, echo=FALSE}
rep_posicoes = rep(p.MRU.posicoes, times=5)
deslocamento_reg = lm(rep_posicoes ~ flatten_by_rows(dados.MRU))
predicted = predict(deslocamento_reg, interval="confidence")

grid.arrange(
  top="Deslocamento x Tempo",
  ggplot(mapping=aes(x=flatten_by_rows(dados.MRU))) 
    + geom_point(aes(y=rep_posicoes))
    + geom_line(aes(y=predicted[,"fit"]))
    + geom_ribbon(aes(ymin=predicted[,"lwr"], ymax=predicted[,"upr"]), alpha=0.15)
    + xlab(TeX(paste("Deslocamento", parens(ph.TeX.deslocamento))))
    + ylab(TeX(paste("Tempo", parens(ph.TeX.tempo))))
    + xlim(c(0.0, 2.0))
    + ylim(c(0.0, 2.0))
  )
```

```{r, fig.width=9, fig.height=3.5, echo=FALSE}
velocidades = t(MRU.velocidade(p.MRU.posicoes, t(dados.MRU)))
colnames(velocidades) = TeX(paste(subscript("v", 1:4), parens(ph.TeX.velocidade)))

velocidade_reg = lm(flatten_by_rows(velocidades) ~ flatten_by_rows(dados.MRU))
predicted = predict(velocidade_reg, interval="confidence")

grid.arrange(
  top="Velocidade x Tempo",
  nrow=1,
  tableGrob(round(velocidades, digits=2), theme=tt),
  ggplot(mapping=aes(x=flatten_by_rows(dados.MRU))) 
    + geom_point(aes(y=flatten_by_rows(velocidades)))
    + geom_line(aes(y=predicted[,"fit"]))
    + geom_ribbon(aes(ymin=predicted[,"lwr"], ymax=predicted[,"upr"]), alpha=0.15)
    + xlab(TeX(paste("Velocidade", parens(ph.TeX.velocidade))))
    + ylab(TeX(paste("Tempo", parens(ph.TeX.tempo))))
    + xlim(c(0.0, 2.0))
    + ylim(c(0.0, 2.0))
  )
```
